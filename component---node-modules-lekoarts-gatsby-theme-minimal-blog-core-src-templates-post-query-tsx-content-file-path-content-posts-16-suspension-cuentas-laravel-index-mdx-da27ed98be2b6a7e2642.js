"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[786],{5174:function(e,n,a){a.r(n),a.d(n,{Head:function(){return u.p},default:function(){return o}});var l=a(6540),t=a(8453);function s(e){const n=Object.assign({span:"span",p:"p",h2:"h2",h3:"h3",code:"code",pre:"pre",hr:"hr",h4:"h4",ul:"ul",li:"li"},(0,t.RP)(),e.components);return l.createElement(l.Fragment,null,l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVR42mP4jwH+/fsHImEMVKk/QPLNo/1Pdgg+P1/OgEXz//9fvvx4dv/W/ZuXf/36hRD/C9L54c2dp7uVP21neHwyA13zr1+/H14/dH573q0dHuc3h37++BbqFrArvn5+/Wy/yac9DE8PWn35+IwB2U1A4tPHL49PT762SffuXo+zK+SeProF0fzrx9c3T47f2eP1eCPD7bWMDy/NAKpmwPTShYN9jzcxfNrP9ngDw7PLEyBSL67PfrmZ4c1O5tvrue9u4Hi0me3O0QKE5r9//wF99fvf/0cHfT7sZHi/j/37QYbnO6WePb528ebLynKf7wcY7m3kOruE/81u1nurGO5sM2WAuAoM/gLZZ0/te7iF5fsRhi97gErZ8zL11B0DFR0iFWwD980W+3+S4elmhisr+O8fy/7y9gYDPG5u3n1Q0tzvEp15c33o3eXyL8/FB0d7CJiEytqEKDhGiltFajh6Nldobl3o/en5PkjoM/z58+f7t6/rtuww8kkQ1nf1TC1b39Z+auWKRZsOy5gH6rpHqTtHaLpGuUZnl7ZOXrH5yP3HH95/+P7l80egboa/f/8+ffxo4eKlO3bu2rN3755du9YtWXjv/r1Vq9fG5ladO3d+5dqNW3fsOnb8xPWrVy6eP3f50vldO3fcunnrx48fDK/fvm+ZMLOsoXPBslULlq+eOmtBfnbB6vWb+qfNCUor3bxj95KVaw8cPHT2zNmjR4+dOXPm/Pnz+/cfuH379q9fvwBqzPJXxCS5wgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="You are banned"\n        title="Estás suspendido"\n        src="/static/f27595671ae9810b548554d9f428de4f/7abe2/you-are-banned.png"\n        srcset="/static/f27595671ae9810b548554d9f428de4f/5243c/you-are-banned.png 240w,\n/static/f27595671ae9810b548554d9f428de4f/ab158/you-are-banned.png 480w,\n/static/f27595671ae9810b548554d9f428de4f/7abe2/you-are-banned.png 900w"\n        sizes="(max-width: 900px) 100vw, 900px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(n.p,null,"La suspensión de cuentas es una funcionalidad común en aplicaciones web que te permite restringir el acceso a los usuarios de forma permanente o temporal. Laravel ofrece herramientas flexibles para lograr esto utilizando campos en la base de datos, middleware y tareas programadas. En esta guía aprenderás cómo implementar ambos tipos de suspensiones."),"\n",l.createElement(n.h2,null,"Suspensión Permanente"),"\n",l.createElement(n.p,null,"Un usuario suspendido permanentemente no podrá acceder a la aplicación hasta que sea reactivado manualmente."),"\n",l.createElement(n.h3,null,"1. Agregar un Campo de Suspensión a la Tabla de Usuarios"),"\n",l.createElement(n.p,null,"Para registrar si un usuario está suspendido, agrega una columna llamada ",l.createElement(n.code,null,"banned_at")," en la tabla ",l.createElement(n.code,null,"users"),":"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"Schema::table('users', function (Blueprint $table) {\n    $table->timestamp('banned_at')->nullable();\n});\n")),"\n",l.createElement(n.h3,null,"2. Actualizar el Modelo de Usuario"),"\n",l.createElement(n.p,null,"Agrega un método en el modelo ",l.createElement(n.code,null,"User")," para verificar si un usuario está suspendido:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"class User extends Authenticatable\n{\n    // Determina si el usuario está suspendido\n    public function isBanned(): bool\n    {\n        return !is_null($this->banned_at);\n    }\n}\n")),"\n",l.createElement(n.h3,null,"3. Crear Middleware para Restringir Acceso a Usuarios Suspendidos"),"\n",l.createElement(n.p,null,"Este middleware bloqueará el acceso a cualquier usuario marcado como suspendido:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"public function handle(Request $request, Closure $next)\n{\n    if (auth()->check() && auth()->user()->isBanned()) {\n        abort(403, 'Tu cuenta ha sido suspendida.');\n    }\n\n    return $next($request);\n}\n")),"\n",l.createElement(n.h3,null,"4. Métodos para Suspender y Reactivar Usuarios"),"\n",l.createElement(n.p,null,"Implementa funciones en un controlador para gestionar las suspensiones:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"// Suspende un usuario permanentemente\npublic function ban(User $user)\n{\n    $user->update([\n        'banned_at' => now(),\n    ]);\n\n    return response()->json(['message' => 'Usuario suspendido exitosamente.']);\n}\n\n// Reactiva un usuario previamente suspendido\npublic function unban(User $user)\n{\n    $user->update([\n        'banned_at' => null,\n    ]);\n\n    return response()->json(['message' => 'Usuario reactivado exitosamente.']);\n}\n")),"\n",l.createElement(n.hr),"\n",l.createElement(n.h2,null,"Suspensión Temporal"),"\n",l.createElement(n.p,null,"En este caso, los usuarios son suspendidos por un período específico y se reactivan automáticamente al finalizar ese tiempo."),"\n",l.createElement(n.h3,null,"1. Modificar la Tabla de Usuarios"),"\n",l.createElement(n.p,null,"Agrega un campo llamado ",l.createElement(n.code,null,"banned_until")," para almacenar la fecha de expiración de la suspensión:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"Schema::table('users', function (Blueprint $table) {\n    $table->timestamp('banned_until')->nullable();\n});\n")),"\n",l.createElement(n.h3,null,"2. Actualizar el Modelo de Usuario"),"\n",l.createElement(n.p,null,"Modifica el método ",l.createElement(n.code,null,"isBanned()")," para comprobar si la suspensión sigue activa:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"class User extends Authenticatable\n{\n    // Verifica si el usuario tiene una suspensión activa\n    public function isBanned(): bool\n    {\n        return !is_null($this->banned_until) && now()->lessThan($this->banned_until);\n    }\n}\n")),"\n",l.createElement(n.h3,null,"3. Middleware para Restringir Acceso a Usuarios Suspendidos Temporalmente"),"\n",l.createElement(n.p,null,"El middleware sigue siendo similar, pero ahora verifica el campo ",l.createElement(n.code,null,"banned_until"),":"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"public function handle(Request $request, Closure $next)\n{\n    if (auth()->check() && auth()->user()->isBanned()) {\n        abort(403, 'Tu cuenta está suspendida temporalmente.');\n    }\n\n    return $next($request);\n}\n")),"\n",l.createElement(n.h3,null,"4. Métodos para Suspender y Reactivar Usuarios Temporalmente"),"\n",l.createElement(n.p,null,"Establece una fecha futura para las suspensiones temporales:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"// Suspende un usuario durante 5 días\npublic function temporaryBan(User $user)\n{\n    $user->update([\n        'banned_until' => now()->addDays(5),\n    ]);\n\n    return response()->json(['message' => 'Usuario suspendido por 5 días.']);\n}\n\n// Reactiva un usuario antes de tiempo\npublic function liftBan(User $user)\n{\n    $user->update([\n        'banned_until' => null,\n    ]);\n\n    return response()->json(['message' => 'Suspensión levantada exitosamente.']);\n}\n")),"\n",l.createElement(n.h3,null,"5. Automatizar la Reactivación con Tareas Programadas"),"\n",l.createElement(n.p,null,"Crea un comando Artisan para eliminar las suspensiones caducadas y configúralo en el scheduler."),"\n",l.createElement(n.h4,null,"Comando para Levantar Suspensiones Caducadas"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"namespace App\\Console\\Commands;\n\nuse App\\Models\\User;\nuse Illuminate\\Console\\Command;\nuse Illuminate\\Support\\Carbon;\n\nclass LiftExpiredBans extends Command\n{\n    protected $signature = 'ban:lift';\n    protected $description = 'Levanta automáticamente las suspensiones caducadas';\n\n    public function handle()\n    {\n        User::whereNotNull('banned_until')\n            ->where('banned_until', '<=', Carbon::now())\n            ->update([\n                'banned_until' => null,\n            ]);\n    }\n}\n")),"\n",l.createElement(n.h4,null,"Configuración del Scheduler"),"\n",l.createElement(n.p,null,"Programa el comando para ejecutarse cada hora añadiendo la siguiente línea en el archivo ",l.createElement(n.code,null,"app/Console/Kernel.php"),":"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-php"},"$schedule->command('ban:lift')->hourly();\n")),"\n",l.createElement(n.hr),"\n",l.createElement(n.h2,null,"Conclusión"),"\n",l.createElement(n.p,null,"En esta guía aprendiste a implementar suspensiones permanentes y temporales en Laravel mediante:"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Campos en la base de datos (",l.createElement(n.code,null,"banned_at")," o ",l.createElement(n.code,null,"banned_until"),")."),"\n",l.createElement(n.li,null,"Middleware para restringir el acceso a usuarios suspendidos."),"\n",l.createElement(n.li,null,"Métodos en controladores para gestionar las suspensiones."),"\n",l.createElement(n.li,null,"Un comando programado para levantar suspensiones automáticamente."),"\n"),"\n",l.createElement(n.p,null,"Con estos pasos podrás gestionar eficazmente el acceso de los usuarios y asegurarte de cumplir con las políticas de tu aplicación."))}var r=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,t.RP)(),e.components);return n?l.createElement(n,e,l.createElement(s,e)):s(e)},u=a(7292);function o(e){return l.createElement(u.A,e,l.createElement(r,e))}u.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-16-suspension-cuentas-laravel-index-mdx-da27ed98be2b6a7e2642.js.map